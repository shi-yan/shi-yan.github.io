<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!-- Primary Meta Tags -->
    <title>Shi&#x27;s blog: Gaussian Splatting in 2D</title>
    <meta name="title" content="Gaussian Splatting in 2D" />
    <meta name="description" content="" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://shi-yan.github.io/gaussian_splatting_in_2d" />
    <meta property="og:title" content="Gaussian Splatting in 2D" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="https://shi-yan.github.io/326807.jpeg" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://shi-yan.github.io/gaussian_splatting_in_2d" />
    <meta property="twitter:title" content="Gaussian Splatting in 2D" />
    <meta property="twitter:description" content="" />
    <meta property="twitter:image" content="https://shi-yan.github.io/326807.jpeg" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>


    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/default-dark.min.css"
        integrity="sha512-EF2rc4QyBiRAGUMVm+EjFPBbdVGaN/pwZhtuKyrC/dM+hcwTxI5BsEDUkrMRI77z4VlDAt/qVopePXB5+ZZ8Gw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="alternate" type="application/rss+xml" title="Shi&#x27;s blog" href="https://shi-yan.github.io/rss.xml" />

    <link rel="stylesheet" href="/style.css" />

    <script src="
        https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js
        "></script>
    <link href="
        https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css
        " rel="stylesheet" />
</head>

<body>
    <div id="page">
        <div id="header"><a class="icon" href="/">Shi&#x27;s blog</a> <a class="icon" href="https://github.com/shi-yan"><svg
                    xmlns="http://www.w3.org/2000/svg" height="32" width="32" fill="#dadadb"
                    viewBox="0 0 480 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z" />
                </svg></a>
            <a class="icon" href="https://shi-yan.github.io/rss.xml" target="_blank"><svg xmlns="http://www.w3.org/2000/svg"
                    height="32" width="32" fill="#dadadb"
                    viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z" />
                </svg>
            </a>
        </div>
        <div id="left"></div>
        <div id="content">
            <div id="title">Gaussian Splatting in 2D</div>
            <div id="meta"><svg xmlns="http://www.w3.org/2000/svg" height="12" width="11" fill="#dadadb"
                    viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z" />
                </svg> 2025-01-19 <svg xmlns="http://www.w3.org/2000/svg" style="margin-left:16px;" height="12" width="11"
                    fill="#dadadb"
                    viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M345 39.1L472.8 168.4c52.4 53 52.4 138.2 0 191.2L360.8 472.9c-9.3 9.4-24.5 9.5-33.9 .2s-9.5-24.5-.2-33.9L438.6 325.9c33.9-34.3 33.9-89.4 0-123.7L310.9 72.9c-9.3-9.4-9.2-24.6 .2-33.9s24.6-9.2 33.9 .2zM0 229.5V80C0 53.5 21.5 32 48 32H197.5c17 0 33.3 6.7 45.3 18.7l168 168c25 25 25 65.5 0 90.5L277.3 442.7c-25 25-65.5 25-90.5 0l-168-168C6.7 262.7 0 246.5 0 229.5zM144 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" style="margin-left:16px;" height="12" width="11" fill="#dadadb"
                    viewBox="0 0 384 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M320 464c8.8 0 16-7.2 16-16V160H256c-17.7 0-32-14.3-32-32V48H64c-8.8 0-16 7.2-16 16V448c0 8.8 7.2 16 16 16H320zM0 64C0 28.7 28.7 0 64 0H229.5c17 0 33.3 6.7 45.3 18.7l90.5 90.5c12 12 18.7 28.3 18.7 45.3V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64z" />
                </svg>
                831 Words
                <svg xmlns="http://www.w3.org/2000/svg" style="margin-left:16px;" height="12" width="11" fill="#dadadb"
                    viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z" />
                </svg>
                3 Mins
            </div>
            <article id="post"><p>I want to implement the training part (the backward path) of gaussian splatting from scratch. But to make this project more approachable, I want to start from a 2D toy version. i.e. given a set of randomly generated 2D gaussian, can I implement a differentiable 2D gaussian render to make them converge to any given images? Previously, I have implemented a render for gaussian splatting (the forward path), but my implementation is slightly different from the render implemented by the original gaussian splatting paper. my implementation  doesn't partition the image into tiles, instead, it does a global sorting on splats based on camera-to-splat distance and directly renders them as semi-transparent rectangles, utilizing hardware alpha blending, whereas in the original paper, an image is partitioned into 16x16 tiles, and within each tile, pixels are calculated individually in a ray casting manner. this makes calculating the gradients possible. Since my use of hardware alpha blending makes calculating gradients impossible, to implement the backward path, I have to rewrite the render first.</p><p>First, let's recap on the math.</p><p>the function of 1d gaussian is the following</p><p>1d.png</p><p>there are two things in the formula determines the properties of a gaussian, one is the mean mu, it determines the location of the gaussian on the x axis. we can also call it the centroid. the other thing is the sigma^2, which is called the variance. sigma is called the standard deviation. The variance determines the shape of the gaussian, or how much it is stretched.</p><p>the more generalized form for k dimensional gaussian is the following:</p><p>kd.png</p><p>in this formula, mu is still the mean, but instead of a single scalar, it is now a vector representing the centroid of the gaussian in the k dimensional space. Sigma is called the covariance matrix, it functions the same way as the variance, i.e. it determines the shape of the gaussian. Since we mostly care about 2D and 3D gaussians, we can hardcode k to 2 or 3. in such a case, the gaussians look like a ellipsoid and the covariance matrix controls the stretch and the rotation of the ellipsoid.</p><p>note that Sigma is the covariance matrix, but what's actually involved in the calculation is the inverse of Sigma^-1. This is called the conic matrix in the gaussian splatting code.</p><p>if we only look at the 2D case, we can expand the above formula into the following:</p><p>with the mean and the covariance matrix defined as below:</p><p>the mean is a 2d vector and the covariance matrix is a 2x2 matrix. not any matrix can be qualified as a covariance matrix, as you can see, the matrix must be symmetric.</p><p>ρ is called the correlation coefficient , a measurement of how dependent x and y are. if ρxsigma_xxsignma_y is zero, then x and y are independent. if ρ is one, it means x and y are perfectly correlated.</p><p>other than being symmetric, a covariance matrix must be positive-definite. hence if you were to randomize a covariance matrix, you can't simply randomize the ρ and sigma_x and sigma_y. it may ends up being an invalid covariance matrix. hence to construct a random covariance matrix, a better way is to randomize the rotation and scaling factor.
<a class="link" href="https://www.visiondummy.com/2014/04/geometric-interpretation-covariance-matrix/" target="_blank">https://www.visiondummy.com/2014/04/geometric-interpretation-covariance-matrix/</a>
as previously mentioned, the covariance matrix defines the shape of a gaussian, i.e. the rotation and scaling. A covariance matrix can be decomposed into a rotation matrix and a scaling matrix.</p><p>The way to do it is the following. Assuming we have a rotation angle theta, we can construct a rotation matrix as the following:</p><p>rotation.png</p><p>scaling.png</p><p>we can define T as RS, and the covariance matrix sigma is RSSR^t = TT^t,</p><p>hence if we randomize the angle theta and the scaling matrix, we can construct a covariance matrix.</p><p>let's look at the code used in the original gaussian splatting:</p><pre><code class="language-cpp code-block">
	float det = (cov.x * cov.z - cov.y * cov.y);
	if (det == 0.0f)
		return;
	float det_inv = 1.f / det;
	float3 conic = { cov.z * det_inv, -cov.y * det_inv, cov.x * det_inv };</code></pre><p>first is the code to calculate the sigma^-1, called the conic matrix in the code.</p><p>the inverse of a matrix A is the following:</p><p>inverse.png</p><p>adj(A) is the Adjugate matrix. for a 2D matrix, it is defined as</p><p>adjugate.png</p><p>the next step is measuring the size of each gaussian to assign it to belonging tiles.</p><pre><code class="language-cpp code-block">	float mid = 0.5f * (cov.x + cov.z);
	float lambda1 = mid + sqrt(max(0.1f, mid * mid - det));
	float lambda2 = mid - sqrt(max(0.1f, mid * mid - det));
	float my_radius = ceil(3.f * sqrt(max(lambda1, lambda2)));
</code></pre><p>this code gets the largest eigen value of the covariance matrix as the radius.</p><p>if the covariance matrix is the following:</p><p>[sigma_x, sigma_xy]
[sigma_xy, sigma_y]</p><p>(sigma_x - x) * (sigma_y - x) - sigma_xy^2 = 0</p><p>sigma_x * sigma_y - (sigma_x + sigma_y) x + x^2 - sigma_xy^2 = 0</p><p>x^2 - (sigma_x + sigma_y) x - (sigma_x * sigma_y - sigma_xy^2) = 0</p><p>using two solutions to the above are:</p><p>(sigma_x + sigma_y) +- sqrt( (sigma_x + sigma_y)^2 - 4 (sigma_x * sigma_y - sigma_xy^2) ) / 2</p><p>(sigma_x + sigma_y)/2 +- sqrt( sigma_x^2 -2sigma_x sigma_y + sigma_y^2  + sigma_xy^2) / 2</p><p>(sigma_x + sigma_y)/2 = mid</p><p>(sigma_x + sigma_y)^2 - 4 (sigma_x * sigma_y - sigma_xy^2) = mid^2 - det</p><p>The squared relative lengths of the principal axes are given by the corresponding eigenvalues</p><pre><code class="language-cpp code-block">float2 d = { xy.x - pixf.x, xy.y - pixf.y };
float4 con_o = collected_conic_opacity[j];
float power = -0.5f * (con_o.x * d.x * d.x + con_o.z * d.y * d.y) - con_o.y * d.x * d.y;
if (power &gt; 0.0f)
	continue;</code></pre></article>
            <div class="older_newer_link_section">
                <div class="older_newer_link_left">
                    <p>


                        <svg xmlns="http://www.w3.org/2000/svg" height="12" width="11" fill="#dadadb"
                            viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                            <path
                                d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
                        </svg>
                        PREV POST


                    </p>
                    <p>
                        <a class="older_newer_link" href="/how_does_flame_work">How Does FLAME Work</a>
                    </p>
                </div>

            </div>
            <a href="https://github.com/shi-yan/shi-yan.github.io/discussions" target="_blank" class="comment"><svg
                    style="margin-right:10px;vertical-align: middle;" xmlns="http://www.w3.org/2000/svg" height="32"
                    width="32" fill="#dadadb"
                    viewBox="0 0 480 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z" />
                </svg> Leave a Comment on Github</a>
        </div>
        <div id="right"></div>
        <div id="footer">Generated by <a class="link" href="https://github.com/shi-yan/QuipQuick"
                target="_blank">QuipQuick</a> @</div>
        <!-- The Modal -->
        <div id="img-modal" class="modal">
            <!-- The Close Button -->
            <span class="close" id="img-close">&times;</span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="img01">

            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        <script>
            function openImage(img) {
                let modal = document.getElementById("img-modal");
                let modalImg = document.getElementById("img01");
                modal.style.display = "block";
                if (img.getAttribute("original_src")) {
                    modalImg.src = img.getAttribute("original_src");
                } else {
                    modalImg.src = img.src;
                }
                let captionText = document.getElementById("caption");

                captionText.innerText = img.alt;

                let sources = JSON.parse(img.getAttribute("sources"));

                for (let i = 0; i < sources.length; ++i) {
                    if (sources.length == 1) {
                        captionText.innerHTML += "<a href='" + sources[i] + "' target='_blank' class='img-source'>SOURCE</a>";
                    } else {
                        captionText.innerHTML += "<a href='" + sources[i] + "' target='_blank' class='img-source'>SOURCE " + (i + 1) + "</a>";
                    }
                }
            }
            // Get the <span> element that closes the modal
            var closeButton = document.getElementById("img-close");

            // When the user clicks on <span> (x), close the modal
            closeButton.onclick = function () {
                var modal = document.getElementById("img-modal");
                modal.style.display = "none";
            }
        </script>
        <script type="module">
            const macros = {};
            const mathElementsBlock = document.getElementsByClassName("math-block");
            for (let element of mathElementsBlock) {
                katex.render(element.textContent, element, {
                    throwOnError: false,
                    displayMode: true,
                    macros
                });
            }

            const mathElementsInline = document.getElementsByClassName("math-inline");
            for (let element of mathElementsInline) {
                katex.render(element.textContent, element, {
                    throwOnError: false,
                    macros
                });
            }

            hljs.highlightAll();

                    async function setBuildTime() {
                        let response = await fetch("/current_time.txt");
                        let currentTime = await response.text();
                        document.getElementById('footer').innerHTML += ' ' + currentTime;
                    }
                    setBuildTime();
        </script>
        <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0N1753LT3Y"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'G-0N1753LT3Y');
</script>
    </div>
</body>

</html>